#!/usr/bin/env ruby
# -*- mode: ruby -*-

if RUBY_VERSION >= "1.9"  # encoding only supported in Ruby 1.9.x
  Encoding.default_external = "UTF-8"
end

$script_base_dir = File.dirname(__FILE__)+"/../lib"
$:.unshift($script_base_dir)

require 'redcarpet'
require 'markdown_to_tex'

processor = MarkdownToTeX::Processor.new

all = ""
ARGV.each do |f|
  i = File.read(f) 
  s = processor.process(i)
  puts processor.job_signature
  puts s
  all += s
end

all.gsub!(/%.*/, '')
all.gsub!(/\s+/, ' ')
all.gsub!(/\\(begin|end){[^}]+}/, '')
all.gsub!(/\\(LL|REP|DEL|REPX|DELX)[^}]+/, '')
all.gsub!(/\\([A-Za-z]+)/, '')
all.gsub!(/L:[A-Za-z1-9]+/, '')
all.gsub!(/\s+/, '')
all.gsub!(/\{|\}/, '')
puts "% Text length: #{all.size} chars"
